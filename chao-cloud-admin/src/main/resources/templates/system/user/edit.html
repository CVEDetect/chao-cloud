<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head th:include="include :: header"></head>
<body>
	<form class="layui-form" action="" lay-filter="user-update-form"
		style="margin-top: 20px;">
		<input name="userId" th:value="${user.userId}" type="hidden">
		<div class="layui-form-item">
			<label class="layui-form-label">用户名：</label>
			<div class="layui-input-block">
				<input name="username" autocomplete="off" class="layui-input"
					placeholder="请输入用户名" th:value="${user.username}"
					lay-verify="required" readonly="readonly">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">真实名称：</label>
			<div class="layui-input-block">
				<input name="name" placeholder="请输入真实名称" autocomplete="off"
					class="layui-input" th:value="${user.name}" lay-verify="required">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">手机号：</label>
			<div class="layui-input-block">
				<input name="mobile" placeholder="请输入手机号" autocomplete="off"
					class="layui-input" th:value="${user.mobile}"
					lay-verify="required|phone">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">E-mail：</label>
			<div class="layui-input-block">
				<input name="email" placeholder="请输入邮箱地址" autocomplete="off"
					class="layui-input" th:value="${user.email}"
					lay-verify="required|email">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">状态：</label>
			<div class="layui-input-block">
				<input th:field="*{user.status}" type="radio" name="status"
					value="1" title="正常" checked> <input
					th:field="*{user.status}" type="radio" name="status" value="0"
					title="禁用">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">选择部门：</label>
			<div class="layui-inline">
				<div class="layui-input-inline">
					<input name="deptId" th:value="${user.deptId}" type="hidden">
					<input name="deptName" lay-verify="required" readonly="readonly"
						class="layui-input layui-elip" th:value="${user.deptName}"
						placeholder="请选择部门">
				</div>
			</div>
			<div class="layui-inline">
				<div class="layui-input-inline">
					<a id="userGroup" href="javascript:;"
						class="layui-btn layui-btn-sm" lay-event="edit"> <i
						class="layui-icon  layui-icon-group"></i>
					</a>
				</div>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">选择角色：</label>
			<div class="layui-input-inline" th:each="role:${roles}">
				<input type="checkbox" name="roleIds[]" th:value="${role.roleId}"
					th:title="${role.roleName}" th:checked="${role.roleSign}">
			</div>
		</div>
		<div class="layui-form-item">
			<div class="layui-input-block">
				<button class="layui-btn" lay-submit="" lay-filter="user-update">立即提交</button>
			</div>
		</div>
	</form>
	<div th:include="include::footer"></div>
	<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
	<script>
		layui.use([ 'layer', 'jquery', 'form' ], function() {
			var $ = layui.jquery;
			var layer = layui.layer;
			var form = layui.form;

			//选择 部门
			$("#userGroup").click(function() {
				layer.open({
					type : 2,
					title : '选择部门',
					maxmin : false,
					shadeClose : false, // 点击遮罩关闭层
					area : [ '40%', '50%' ],
					content : '/sys/dept/choose' // iframe的url
				});
			})

			//监听提交
			form.on('submit(user-update)', function(data) {
				//提交数据data.field
				$.ajax({
					cache : true,
					type : "POST",
					url : "/sys/user/update",
					data : data.field,
					async : false,
					error : function(request) {
						laryer.alert("Connection error");
					},
					success : function(data) {
						if (data.code == 0) {
							parent.layer.msg("保存成功");
							parent.location.reload(); // 父页面刷新
							var index = parent.layer.getFrameIndex(window.name); // 获取窗口索引
							parent.layer.close(index);
						} else {
							layer.alert(data.msg)
						}
					}
				});
				return false;
			});
		});
	</script>
</body>
</html>